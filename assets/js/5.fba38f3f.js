(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{53:function(e,t,s){e.exports=s.p+"assets/img/pwa-fullscreen.20336af1.jpg"},54:function(e,t,s){e.exports=s.p+"assets/img/splash-screen.969824ea.jpg"},55:function(e,t,s){e.exports=s.p+"assets/img/pwa_install.cc0b35b6.jpg"},56:function(e,t,s){e.exports=s.p+"assets/img/pwa_install_menu.ee008090.jpg"},57:function(e,t,s){e.exports=s.p+"assets/img/cache_storage.04f1ba9e.png"},66:function(e,t,s){"use strict";s.r(t);var a=[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"etape-3-precaching-des-assets-statiques-pour-un-mode-offline-basique"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#etape-3-precaching-des-assets-statiques-pour-un-mode-offline-basique","aria-hidden":"true"}},[this._v("#")]),this._v(" Etape 3 : Precaching des assets statiques pour un mode offline basique")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("On a vu dans l'étape précédent deux méthodes du cycle de vie d'un Service Worker: "),t("code",[this._v("install")]),this._v(" et "),t("code",[this._v("activate")]),this._v(". Dans cette partie, on va poursuivre notre exploration des PWA en mettant en cache les fichiers statiques.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"exploration-des-api-de-mise-en-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#exploration-des-api-de-mise-en-cache","aria-hidden":"true"}},[this._v("#")]),this._v(" Exploration des API de mise en cache")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("Parmi les "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[e._v("API auquel a accès le Service Worker")]),e._v(", celle qui nous intéresse est "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Cache",target:"_blank",rel:"noopener noreferrer"}},[e._v("l'API Cache")]),e._v(". En effet, elle permet de mettre dans un cache persistant les paires Requêtes/Réponses via la méthode "),s("code",[e._v("cache.put(request, response)")]),e._v(". Il est également possible de passer une ou plusieurs URL en argument des méthodes "),s("code",[e._v("add")]),e._v(" et "),s("code",[e._v("addAll")]),e._v(" ; elles seront requêtées et la réponse sera ajoutée au cache. On peut également supprimer des entrées du cache avec la méthode "),s("code",[e._v("delete")]),e._v(".")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("Les différents caches sont accessibles via la variable "),s("code",[e._v("caches")]),e._v(" depuis le Service Worker. C'est l'API "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage",target:"_blank",rel:"noopener noreferrer"}},[e._v("CacheStorage")]),e._v(" qui permet, entre autres, de créer/obtenir un objet cache ou d'en supprimer un avec les fonctions "),s("code",[e._v("open")]),e._v(" et "),s("code",[e._v("delete")]),e._v(". Les différents caches sont identifiés par des clés de type "),s("em",[e._v("string")]),e._v(" dans le "),s("code",[e._v("CacheStorage")]),e._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Enfin, une autre méthode intéressante du cache est "),t("code",[this._v("match")]),this._v(": elle vérifie dans les tous les objets "),t("code",[this._v("Cache")]),this._v(" gérés par le "),t("code",[this._v("CacheStorage")]),this._v(" si une requête est identique à celle passée en paramètre. Si c'est le cas, elle retourne un promesse qui permet d'accéder à la réponse en cache.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"ajout-des-fichiers-statiques-dans-le-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ajout-des-fichiers-statiques-dans-le-cache","aria-hidden":"true"}},[this._v("#")]),this._v(" Ajout des fichiers statiques dans le cache")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Nous allons mettre en cache les fichiers statiques essentiels de l'application, et ce le plus tôt possible. Le moment opportun pour cela est l'évènement "),t("code",[this._v("install")]),this._v(" du Service Worker, car il n'est appelé qu'une fois lors de son installation. C'est ce qu'on appelle le "),t("em",[this._v("precaching")]),this._v(".")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ol",[s("li",[e._v("Placez-vous dans "),s("code",[e._v("sw.js")]),e._v(" dans le callback de l'événement "),s("code",[e._v("install")]),e._v(" vu à l'étape 2.")]),s("li",[e._v("Ouvrez le cache avec "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/open",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("caches.open('V1')")])]),e._v(", qui retourne une promesse résolue avec l'objet "),s("code",[e._v("cache")]),e._v(". Le numéro de version dans le nom du cache nous sera utile pour les mises à jour ultérieures.")]),s("li",[e._v("Une fois le cache ouvert, ajoutez au cache avec "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Cache/addAll",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("cache.addAll(['url1','url2',...])")])]),e._v(" les URL vers les fichiers statiques essentiels de notre application: la page HTML racine, le fichier "),s("code",[e._v("styles.css")]),e._v(" et le fichier "),s("code",[e._v("scripts.js")]),e._v(".")]),s("li",[e._v("Afin que le Service Worker s'active une fois le precaching terminé, passez la "),s("code",[e._v("Promise")]),e._v(" retournée par "),s("code",[e._v("cache.addAll")]),e._v(" en argument à "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent/waitUntil",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("event.waitUntil()")])]),e._v(", "),s("code",[e._v("event")]),e._v(" était l'évènement d'installation.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Rechargez la page et le Service Worker, en vérifiant bien que la nouvelle version du Service Worker remplace l'ancienne comme vu à l'étape 2. On peut alors vérifier que les fichiers sont ajoutés dans le cache en consultant l'écran "),t("em",[this._v("Cache Storage")]),this._v(" de l'onglet "),t("em",[this._v("Application")]),this._v(" des Developer Tools.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:s(57),alt:"Cache storage"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"reponse-avec-le-cache-en-priorite"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reponse-avec-le-cache-en-priorite","aria-hidden":"true"}},[this._v("#")]),this._v(" Réponse avec le cache en priorité")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("Maintenant que les fichiers sont en cache, il nous reste à indiquer d'utiliser la version en cache lorsque le navigateur les demande. Pour ce faire, nous allons passer par l'évènement "),s("code",[e._v("fetch")]),e._v(". Ce dernier intercepte tous les appels émis par les clients ayant installé le Service Worker. On peut alors retourner une réponse personnalisée avec "),s("code",[e._v("event.respondWith")]),e._v(", où "),s("code",[e._v("event")]),e._v(" est le "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent",target:"_blank",rel:"noopener noreferrer"}},[e._v("FetchEvent")]),e._v(". La fonction "),s("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/respondWith",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("event.respondWith")])]),e._v(" prend comme unique argument une promesse qui devra être résolue avec la réponse à retourner.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("self"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'fetch'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" event "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\tconsole"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("log")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[e._v("`Request of ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("request"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("url"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),s("span",{attrs:{class:"token string"}},[e._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\t\n\t"),s("span",{attrs:{class:"token comment"}},[e._v("// comportement par défaut: requête le réseau")]),e._v("\n\tevent"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("respondWith")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v(" "),s("span",{attrs:{class:"token function"}},[e._v("fetch")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("request"),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Nous voulons changer le comportement par défaut et retourner les versions préalablement mises en cache si elles existent. Justement, la fonction "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/match",target:"_blank",rel:"noopener noreferrer"}},[t("code",[this._v("caches.match")])]),this._v(" retourne une promesse résolue avec un objet "),t("code",[this._v("Response")]),this._v(", tout comme "),t("code",[this._v("fetch(event.request)")]),this._v(". On peut donc remplacer l'un par l'autre pour retourner les fichiers statiques en cache au lieu d'aller les chercher sur le réseau.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ol",[s("li",[e._v("Ajoutez un callback pour l'événement "),s("code",[e._v("fetch")]),e._v(", de la même façon que vous l'avez fait pour "),s("code",[e._v("install")]),e._v(" à l'étape précédente.")]),s("li",[e._v("Appelez la méthode "),s("code",[e._v("caches.match(event.request)")]),e._v(" pour chercher dans le cache une éventuelle réponse mise en cache pour la requête correspondante.")]),s("li",[e._v("Si aucune entrée dans le cache n'est trouvée, la promesse est résolue avec la valeur "),s("code",[e._v("undefined")]),e._v(". Dans ce cas, il faut requêter le réseau et retourner "),s("code",[e._v("fetch(event.request)")]),e._v(" à la place.")]),s("li",[e._v("Il ne reste plus qu'à retourner cette promesse de réponse à la requête en la passant en argument à "),s("code",[e._v("event.respondWith()")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"test-de-fonctionnement-offline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#test-de-fonctionnement-offline","aria-hidden":"true"}},[this._v("#")]),this._v(" Test de fonctionnement offline")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"mise-a-jour-du-cache-statique"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mise-a-jour-du-cache-statique","aria-hidden":"true"}},[this._v("#")]),this._v(" Mise à jour du cache statique")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Pour gérer ce problème, une solution est de passer par un nouveau cache avec un autre nom. L'idée ici serait de créer un nouveau cache "),t("strong",[this._v("V2")]),this._v(" qui contient les nouveaux fichiers et de supprimer l'ancien cache.")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ol",[s("li",[e._v("Dans le callback de l'événement "),s("code",[e._v("install")]),e._v(", changez le nom du cache en "),s("code",[e._v("V2")])]),s("li",[e._v("Dans le callback de l'événement "),s("code",[e._v("activate")]),e._v(", supprimez l'ancien cache avec "),s("code",[e._v("caches.delete('V1')")])]),s("li",[e._v("Passez la "),s("code",[e._v("Promise")]),e._v(" retournée par "),s("code",[e._v("caches.delete")]),e._v(" dans "),s("code",[e._v("event.waitUntil")]),e._v(" afin d'attendre la suppression du cache avant la fin de l'étape d'activation")]),s("li",[s("em",[e._v("(facultatif)")]),e._v(" - Améliorez votre code de nettoyage des anciens caches en supprimant tous les caches qui ne font pas partie de votre liste de caches connus et utilisés. Vous pouvez parcourir tous les caches existants avec la méthode "),s("code",[e._v("caches.keys()")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"installation-de-la-pwa"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#installation-de-la-pwa","aria-hidden":"true"}},[this._v("#")]),this._v(" Installation de la PWA")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Selon le navigateur et l'OS, les conditions techniques requises pour pouvoir installer la PWA sur le système varient. Mais en principe, si vous avez un manifeste et un Service Worker actif gérant les requêtes entrantes avec "),t("code",[this._v("fetch")]),this._v(", alors vous pouvez actuellement installer cette PWA sur toutes les plates-formes supportées, et elles mettront à profit le manifeste et le Service Worker.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("L'installation de PWA est supportée sur Chrome OS mais encore expérimentale sur les autres systèmes avec Chrome. Vous pouvez activer l'installation de PWA avec Chrome sur Windows en activant ce flag: "),t("strong",[this._v("chrome://flags/#enable-pwa-full-code-cache")]),this._v(" ; mais le support est encore incomplet.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("La plate-forme ayant la meilleure intégration ce jour est "),t("strong",[this._v("Android")]),this._v(". Si vous disposez d'un smartphone Android pouvant requêter votre serveur suite à un partage de connexion, essayez de charger l'application via Chrome for Android. Une fois la page web ouverte, le menu de Chrome devrait comporter l'option: "),t("strong",[this._v("Add to home screen")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:s(56),alt:"Add to home screen"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:s(55),alt:"PWA bookmark"}}),t("img",{attrs:{src:s(54),alt:"Splash-screen"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Vous remarquerez que la barre d'adresse et le reste de l'interface du navigateur ne sont plus présentes, si vous avez configuré la propriété "),t("code",[this._v("display")]),this._v(" correctement dans le manifeste.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:s(53),alt:"PWA run from bookmark"}})])}],n=s(0),r=Object(n.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[e._m(0),e._m(1),e._m(2),e._m(3),e._m(4),e._m(5),e._m(6),e._m(7),e._m(8),s("Solution",[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{attrs:{class:"token constant"}},[e._v("CACHE_NAME")]),e._v(" "),s("span",{attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'V1'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{attrs:{class:"token constant"}},[e._v("STATIC_CACHE_URLS")]),e._v(" "),s("span",{attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{attrs:{class:"token string"}},[e._v("'/'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'styles.css'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'scripts.js'")]),s("span",{attrs:{class:"token punctuation"}},[e._v("]")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nself"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'install'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" event "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  console"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("log")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'Service Worker installing.'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("waitUntil")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    caches"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("open")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token constant"}},[e._v("CACHE_NAME")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("then")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("cache "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" cache"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("addAll")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token constant"}},[e._v("STATIC_CACHE_URLS")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("  \n  "),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),e._m(9),e._m(10),e._m(11),e._m(12),e._m(13),e._m(14),e._m(15),s("Solution",[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[e._v("self"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'fetch'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" event "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{attrs:{class:"token comment"}},[e._v("// Stratégie Cache-First")]),e._v("\n  event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("respondWith")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    caches"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("match")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("request"),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{attrs:{class:"token comment"}},[e._v("// On vérifie si la requête a déjà été mise en cache")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("then")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("cached "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" cached "),s("span",{attrs:{class:"token operator"}},[e._v("||")]),e._v(" "),s("span",{attrs:{class:"token function"}},[e._v("fetch")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),e._v("request"),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{attrs:{class:"token comment"}},[e._v("// sinon on requête le réseau")]),e._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),e._m(16),s("p",[e._v("Si tout a été fait correctement, vous devriez désormais pouvoir tester l'application en mode offline. Coupez votre serveur local et essayez de recharger l'application. La page en cache devrait alors s'afficher.")]),e._m(17),s("p",[e._v("La mise en cache des fichiers statiques pose un problème; que se passe-t-il si j'ajoute, supprime, ou modifie des fichiers ?")]),s("p",[e._v("Tel que nous avons codé actuellement notre Service Worker, on rechargera toujours les fichiers en cache, donc les nouvelles versions déployées sur le serveur ne seront jamais utilisées.")]),e._m(18),e._m(19),s("Solution",[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),s("span",{attrs:{class:"token constant"}},[e._v("CACHE_NAME")]),e._v(" "),s("span",{attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{attrs:{class:"token string"}},[e._v("'V2'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\nself"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("addEventListener")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token string"}},[e._v("'activate'")]),s("span",{attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" event "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{attrs:{class:"token comment"}},[e._v("// delete any unexpected caches")]),e._v("\n  event"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("waitUntil")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    caches"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("keys")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("then")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("keys "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" keys"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("filter")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("key "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" key "),s("span",{attrs:{class:"token operator"}},[e._v("!==")]),e._v(" "),s("span",{attrs:{class:"token constant"}},[e._v("CACHE_NAME")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("then")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("keys "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" Promise"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("all")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("keys"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("map")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("key "),s("span",{attrs:{class:"token operator"}},[e._v("=>")]),e._v(" "),s("span",{attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        console"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token function"}},[e._v("log")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[e._v("`Deleting cache ")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("key"),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),s("span",{attrs:{class:"token string"}},[e._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),s("span",{attrs:{class:"token keyword"}},[e._v("return")]),e._v(" caches"),s("span",{attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{attrs:{class:"token keyword"}},[e._v("delete")]),s("span",{attrs:{class:"token punctuation"}},[e._v("(")]),e._v("key"),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),e._m(20),e._m(21),e._m(22),e._m(23),e._m(24),s("p",[e._v("Poursuivre l'installation. Un nouveau raccourci devrait apparaitre dans l'écran d'accueil du smartphone. C'est le raccourci vers notre PWA !")]),e._m(25),s("p",[e._v("Une fois la PWA installée, quand on clique sur le raccourci, un splash screen est affiché brièvement. Celui-ci reprend les couleurs et l'icône spécifiée dans le manifeste.")]),e._m(26),e._m(27)],1)},a,!1,null,null,null);t.default=r.exports}}]);